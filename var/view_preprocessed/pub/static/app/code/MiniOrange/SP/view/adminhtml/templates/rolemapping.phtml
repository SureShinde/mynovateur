<!-- This template file is for the saml Attribute/Role Mapping settings. File acts as a view file for our attribute / role mapping page. --><?php $roles = $this->getAllRoles(); $groups = $this->getAllGroups(); $isEnabled = $this->isEnabled(); $disabled = !$isEnabled ? "disabled" : ""; $saml_am_username = $this->getUserNameMapping(); $saml_am_email = $this->getUserEmailMapping(); $saml_am_first_name = $this->getFirstNameMapping(); $saml_am_last_name = $this->getLastNameMapping(); $saml_am_group_name = $this->getGroupMapping(); $saml_am_account_matcher = $this->getAccountMatcher(); $emailSelected = $saml_am_account_matcher == 'email' ? 'selected="selected"' : ""; $usernameSelected = $saml_am_account_matcher == 'username' ? 'selected="selected"' : ""; $saml_am_dont_allow_unlisted_user_role = $this->getDisallowUnlistedUserRole(); $mo_saml_dont_create_user_if_role_not_mapped = $this->getDisallowUserCreationIfRoleNotMapped(); $admin_roles_configured = $this->getRolesMapped(); $customer_roles_configured = $this->getGroupsMapped(); $default_role = $this->getDefaultRole(); $default_group = $this->getDefaultGroup(); $formKey = $this->getBlockHtml('formkey'); $premiumlink = $this->getExtensionPageUrl('upgrade'); echo '<div class="page" id="attrmapping"><div class="mosaml_table_layout"><form name="f" method="post" action=""> '.$formKey.' <input type="hidden" name="option" value="saveAttrSettings" /><h3>Role Mapping (Optional)</h3><hr/><table><tr><td colspan="2"><div class="mo_note"><span class="btn-link" href="">What is Role Mapping?</span> <div hidden class="collapse"><ol><li>Magento uses a concept of Roles, designed to give the site owner the ability to control what users can and cannot do within the site.</li> <li>Role mapping helps you to assign specific roles to users of a certain group in your IdP.</li> <li>While auto registering, the users are assigned roles based on the group they are mapped to.</li></ol></div></div></td></tr><tr><td colspan="2"><b>NOTE:</b>Role will be assigned only to non-admin users (user that do NOT have Administrator privileges). You will have to manually change the role of Administrator users.</td></tr><tr><td colspan="2"><input type="checkbox" id="dont_create_user_if_role_not_mapped" name="mo_saml_dont_create_user_if_role_not_mapped" value="checked" '.$mo_saml_dont_create_user_if_role_not_mapped.' />&nbsp;&nbsp;Do not auto create users if roles are not mapped here.</td></tr><tr><td colspan="2"><input type="checkbox" id="dont_allow_unlisted_user_role" name="saml_am_dont_allow_unlisted_user_role" value="checked" '.$saml_am_dont_allow_unlisted_user_role.' /> &nbsp;&nbsp;Do not assign role to unlisted users.</td></tr><tr><td><strong>Default Role:</strong></td><td><select id="saml_am_default_role" name="saml_am_default_role" style="width:150px;" >'; foreach($roles as $role) { $selected = $default_role==$role['label']? 'selected' : ''; echo '<option id="mo2f_roles" '. $selected .' name="'.$role['label'].'" value="'.$role['label'].'"/>'. $role['label'].'</option>'; } foreach($groups as $group) { $selected = $default_role==$group['label']? 'selected' : ''; echo '<option id="mo2f_roles" '. $selected .' name="'. $group['label'].'" value="'.$group['label'].'"/>'. $group['label'].'</option>'; } echo'</select> <i>Select the default role to assign to new Users.</i></td></tr>'; foreach ($roles as $role) { $role_value = $role['value']; $role_name = $role['label']; if(empty($admin_roles_configured)) { $admin_roles=array(); $value = array_key_exists($role_value, $admin_roles) ? $admin_roles[$role_value] : ""; } else{ $admin_roles = $admin_roles_configured ; $value = array_key_exists($role_value, $admin_roles) ? $admin_roles[$role_value] : ""; } echo '<tr><td><b>' . $role_name .'</b></td><td><input type="text" name="saml_am_admin_attr_values_' . $role_value . '" value="' . $value .'" placeholder="Semi-colon(;) separated Group/Role value for ' . $role_name . '" style="width: 400px;" /></td></tr>'; } echo ' <tr><td><strong>Default Group (For Frontend Users):</strong></td><td><select id="saml_am_default_group" name="saml_am_default_group" '.$disabled.' style="width:150px;" >'; foreach($groups as $group) { $selected = $default_group ==$group['label']? 'selected' : ''; echo '<option id="mo2f_groups" '. $selected .' name="'. $group['label'].'" value="'.$group['label'].'"/>'. $group['label'].'</option>'; } if(empty($customer_roles_configured)){ $customer_fields = array(); }else{ $customer_fields = $customer_roles_configured; } foreach ($groups as $group) { $role_value = $group['value']; $role_name = $group['label']; $value = array_key_exists($role_value, $customer_fields) ? $customer_fields[$role_value] : ""; echo '<tr><td><b>' . $role_name .'</b></td><td><input type="text" name="saml_am_group_attr_values_' . $role_value . '" value="' . $value .'" placeholder="Semi-colon(;) separated Group/Role value for ' . $role_name . '" style="width: 400px;" /></td></tr>'; } echo' <tr><td>&nbsp;</td><td><br /><input type="submit" style="width:100px;" name="submit" value="Save" /> &nbsp; <br /><br /></td></tr></table></form></div></div>';